function imgLaterLoad(a){$("#page img").map(function(){var b=$(this).attr("src");$(this).attr("src",a),$(this).attr("alt",b)})}function showImage(a,b){var c=new Image;c.onload=function(){$("#page img").each(function(){$(this).attr("alt"),$(this).attr("alt")==a&&($(this).attr("src",b),$(this).attr("alt",""))})},c.src=b}function createXmlRequest(){var a=null;if(window.XMLHttpRequest)a=new XMLHttpRequest;else if(window.ActiveXObject)try{a=new ActiveXObject("Msxml2.XMLHTTP")}catch(b){try{a=new ActiveXObject("Microsoft.XMLHTTP")}catch(c){a=null}}return a}function debugTrace(a){a||(console=new Object,console.log=function(){})}function getLog(a){window.jsObj.getHtmlContent(a)}function getLogs(){}function showAndroidToast(a){window.android.showToast(a)}function showHtmlcallJava(){window.jsObj.HtmlcallJava2("1234")}function showFromHtml(){document.getElementById("id_input").value="Java call Html"}function handleOnfocus(){console.log("onfocus"),id_of_getcurposy_interval=window.setInterval(function(){loopGetCursorCurPosY()},200),id_of_checkchange_interval=window.setInterval(function(){checkContentChangeOrNot()},1e4)}function handleOnblur(){console.log("onblur"),window.clearInterval(id_of_getcurposy_interval),window.clearInterval(id_of_checkchange_interval)}function loopGetCursorCurPosY(){try{if(handleSpecialContentFlag)return console.log("skip when edit add content"),void 0;getNodeStyle();var a=getPosY();cursorCurPosY!=a&&(cursorCurPosY=a)}catch(b){console.log("loopGetCursorCurPosY error: "+b)}}function checkContentChangeOrNot(){contentChange&&(contentChange=!1)}function getRange(){var a=window.getSelection(),b=a.rangeCount;b>0&&(rg=a.getRangeAt(0)),rg||(document.getElementById("page").focus(),a=window.getSelection(),rg=a.getRangeAt(0),console.log("to root range"))}function updateCollapsedRange(a,b){var c,d;a&&(c=document.createRange(),c.setStart(a,b),c.setEnd(a,b),c.collapsed=!0,d=window.getSelection(),d.removeAllRanges(),d.addRange(c))}function imgSize(){var a=$("#site").width(),b=$("#page").width();$("#page p img").attr("width",b),$(".imgCommonStyle").attr("width",b),$(".imgLandwideStyle ,.imgPolaroidStyle ,.title-img ,.mask-gradiant ,.mask-solid").attr("width",a),console.log("img adapter device! width:"+a)}function addImage(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q,r,s;try{handleSpecialContentFlag=!0,f=rg.startContainer,g=f.nodeName.toUpperCase(),rg.startOffset,h=!1,i=null,j=!1,k=1,l=document.createElement("p"),l.innerHTML="<img class='"+b+"' src='"+a+"' width='"+c+"' height='"+d+"' originalsrc='"+e+"' onerror='imgBreak(this)'/>","#TEXT"==g?(f=f.parentNode,g=f.nodeName.toUpperCase(),"LI"==g?(l=l.firstChild,l.style.display="block",l.style.marginLeft="imgCommonStyle"==b?"-1.5em":"-2.5em",f.appendChild(l),j=!0):("P"==g&&"BLOCKQUOTE"==f.parentNode.nodeName.toUpperCase()?(l=l.firstChild,l.style.display="block",l.style.marginLeft="-1.35em",i=f):i=l,f.parentNode.insertBefore(l,f.nextSibling),h=!0)):("<br>"==f.innerHTML&&(f.innerHTML=""),"LI"==g?(l=l.firstChild,l.style.display="block",l.style.marginLeft="imgCommonStyle"==b?"-1.5em":"-2.5em",""==f.innerHTML&&(f.innerHTML="<br>"),f.appendChild(l),j=!0):(m=!1,n=!1,"P"==g&&"BLOCKQUOTE"==f.parentNode.nodeName.toUpperCase()?(m=!0,l=l.firstChild,l.style.display="block",l.style.marginLeft="-1.35em"):"P"==g&&(n=!0),""!=f.innerHTML?(f.parentNode.insertBefore(l,f.nextSibling),i=l):m?(o=$(f).index(),$(f).replaceWith($(l)),i=l.parentNode,l===i.lastChild?k=o+1:(i=l.previousSibling.childNodes[0],k=i.nodeValue.length)):(f.innerHTML=l.innerHTML,n||(f.firstChild.style.display="block"),i=l),h=!0)),j&&(p=l.parentNode,p.parentNode.lastChild==p?(q=document.createElement("li"),q.innerHTML="<br>",p.parentNode.appendChild(q),i=q):i=p.nextSibling,k=0,h=!0),h&&i&&(updateCollapsedRange(i,k),contentChange=!0,bindImgClickEventHandler(),r=document.getElementById("page"),s=r.lastChild,i==s&&(l=document.createElement("p"),l.innerHTML="<br>",r.appendChild(l))),imgSize()}catch(t){debugMode&&setTimeout(testFunForInsertImg,1e3,"insert img e: "+t)}handleSpecialContentFlag=!1}function testFunForInsertImg(a){alert(a)}function clearContent(){var a,b=document.getElementById("page");b.innerHTML="<p><br></p>",a=b.childNodes[0],updateCollapsedRange(a,0),contentChange=!0}function addContent(a){var b,c,d,e=a.length;return 0>=e?void 0:(contentChange=!0,b=rg.startContainer,c=b.nodeName.toUpperCase(),"#TEXT"==c?(a=a.replace(/\r\n/g,""),a=a.replace(/\n/g,""),document.execCommand("insertText",!1,a),void 0):"H1"==c||"H2"==c||"LI"==c?(a=a.replace(/\r\n/g,""),a=a.replace(/\n/g,""),e=a.length,"<br>"==b.innerHTML?(b.innerHTML=a,updateCollapsedRange(b.childNodes[0],e)):"H1"==c||"H2"==c?(d=document.createElement("p"),d.innerHTML=a,$(d).insertAfter($(b)),updateCollapsedRange(d.childNodes[0],e)):document.execCommand("insertText",!1,a),void 0):"P"==c||"BLOCKQUOTE"==c?"P"==c&&"<br>"==b.innerHTML?(b.innerHTML="",document.execCommand("insertText",!1,a),void 0):(a=a.replace(/\r\n/g,""),a=a.replace(/\n/g,""),e=a.length,d=document.createElement("p"),d.innerHTML=a,$(d).insertAfter($(b)),updateCollapsedRange(d.childNodes[0],e),void 0):void 0)}function checkObjCNullArg(a){return 0==a.length||-1!=a.indexOf("null")}function setUserFontStyle(a,b){checkObjCNullArg(a)||checkObjCNullArg(b)||(usrFontFamily=a,usrFontColor=b,$("p").css({color:b,"font-family":a,"font-size":"1em","font-weight":"normal","font-style":"normal","text-decoration":"none","text-align":"left"}),console.log("js setUserFontStyle func called"))}function getNodeStyle(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n;if(curPositionY=getPosY(),getRange(),a=rg.startContainer,b=a.nodeName.toLowerCase(),"#text"==b&&("div"==a.parentNode.nodeName.toLowerCase()&&(c=rg.startOffset,a.parentNode!==document.getElementById("page")&&($(a).unwrap(),updateCollapsedRange(a,c)),$(a).wrap("<p></p>"),updateCollapsedRange(a,c)),a=a.parentNode,b=a.nodeName.toLowerCase()),"li"==b&&(a=a.parentNode,b=a.nodeName.toLowerCase()),d=b.toLowerCase(),e="",f=a.style.fontFamily,g=a.style.fontSize,h=a.style.color,i=a.style.fontStyle,j=a.style.fontWeight,k=a.style.textDecoration,l=a.style.textAlign,"p"==d&&"blockquote"==a.parentNode.nodeName.toLowerCase()&&(d="blockquote",e=a.parentNode.className.toLowerCase()),"blockquote"==d&&null!=a.lastChild&&"img"==a.lastChild.nodeName.toLowerCase()&&(d="blockquote",e=a.className.toLowerCase()),""==f&&(f=0==cardType?usrFontFamily:"Kaiti SC",g=0==cardType?"1em":"1.375em",h=usrFontColor.replace("rgba","rgb"),h=h.replace(",1.0",""),h=0==cardType?h:"rgb(240,239,244)",i="normal",j="normal",k="none",l=0==cardType?"left":"center","blockquote"==a.parentNode.nodeName.toLowerCase()?(f="Kaiti SC",g="0.875em"):"ul"==d||"ol"==d||"h1"==d&&(g="1.375em",j="bold")),f=f.replace("'",""),f=f.replace("'",""),h=h.replace(")",",1.0)"),h=h.replace(" ",""),h=h.replace(" ",""),h=h.replace("rgb","rgba"),d!=curNodeName||e!=curClassName||f!=curFontFamily||g!=curFontSize||h!=curFontColor||i!=curFontStyle||j!=curFontWeight||k!=curTextDecoration||l!=curTextAlign){if(m=""==e?"class="+d+";":"class="+d+","+e+";","div"==d||"span"==d||"font"==d)return debugMode&&alert("style node is error: "+d),void 0;n=m+"fontFamily="+f+";"+"fontSize="+g+";"+"color="+h+";"+"fontWeight="+j+";"+"fontStyle="+i+";"+"textDecoration="+k+";"+"textAlign="+l,window.jsObj.getJSStyle(n),curNodeName=d,curClassName=e,curFontFamily=f,curFontSize=g,curFontColor=h,curFontStyle=i,curFontWeight=j,curTextDecoration=k,curTextAlign=l}}function changeStyle(a){var b,c,d,e,f,g,h,i,j,k,l,m;try{for(b=a.split(";"),c=/'/g,d={},e=0;e<b.length;e++)f=b[e].split("="),d[f[0]]=f[1].replace(c,"");if(g=window.getSelection(),0==g.rangeCount)return;if(h=g.getRangeAt(0),!h.collapsed)return;if(i=h.startContainer,j=h.startOffset,k=i.nodeName.toLowerCase(),"p"==k&&1==i.childNodes.length&&$(i).find("img").length>0)return;if(d["nodeName"]==k&&"blockquote"!=i.parentNode.nodeName.toLowerCase()&&"blockquote"!=k)return changeElementStyle(i,d),void 0;l=null,"#text"==k?(m=i.parentNode,k=m.nodeName.toLowerCase(),"p"==k?l=changePNodeStyle(m,d):"h1"==k||"h2"==k?l=changeHNodeStyle(m,d,i):"li"==k?l=changeLiNodeStyle(m,d,h):debugMode&&alert("rgtext not handle: "+k)):"p"==k?l=changePNodeStyle(i,d):"li"==k?l=changeLiNodeStyle(i,d,h):"h1"==k||"h2"==k?l=changeHNodeStyle(i,d,i):"blockquote"==k&&null!=i.lastChild&&"img"==i.lastChild.nodeName.toLowerCase()?l=changeBlockquoteImgStyle(i.lastChild,d):debugMode&&alert("start container not handle: "+k),l&&updateCollapsedRange(l,j),curNodeName=d["nodeName"],curClassName=d["className"],curFontFamily=d["fontFamily"],curFontSize=d["fontSize"],curFontColor=d["color"],curFontStyle=d["fontStyle"],curFontWeight=d["fontWeight"],curTextDecoration=d["textDecoration"],curTextAlign=d["textAlign"]}catch(n){debugMode&&alert("changeStyle e: "+n)}}function changeElementStyle(a,b){$(a).css({color:b["color"],"font-family":b["fontFamily"],"font-size":b["fontSize"],"font-weight":b["fontWeight"],"font-style":b["fontStyle"],"text-decoration":b["textDecoration"],"text-align":b["textAlign"]})}function getElementStyle(a){var b={};return b["color"]=a.style.color,b["fontFamily"]=a.style.fontFamily,b["fontSize"]=a.style.fontSize,b["fontWeight"]=a.style.fontWeight,b["fontStyle"]=a.style.fontStyle,b["textDecoration"]=a.style.textDecoration,b["textAlign"]=a.style.textAlign,b}function changePNodeStyle(a,b){var c,d,e,f,g,h=a.nodeName.toLowerCase();if("p"!=h)return null;if(c=b["nodeName"],"blockquote"==a.parentNode.nodeName.toLowerCase()){if("blockquote"==c)return a.parentNode.className=b["className"],changeElementStyle($(a.parentNode).find("p"),b),a.childNodes[0];a=unwrapPNodeBlockquote(a),h=a.nodeName.toLowerCase()}return"p"==c?(changeElementStyle(a,b),a.childNodes[0]):"blockquote"==c?(d=document.createElement(c),d.className=b["className"],changeElementStyle(a,b),$(a).wrap(d),a.childNodes[0]):"h1"==c||"h2"==c?(e=document.createElement(c),e.innerHTML=a.innerHTML,changeElementStyle(e,b),$(a).replaceWith($(e)),e.childNodes[0]):"ol"==c||"ul"==c?(f=document.createElement("li"),f.innerHTML=a.innerHTML,$(f).wrap("<"+c+"></"+c+">"),g=f.parentNode,changeElementStyle(g,b),$(a).replaceWith($(g)),f.childNodes[0]):null}function changeHNodeStyle(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q=a.nodeName.toLowerCase();return"h1"!=q&&"h2"!=q?null:(d=b["nodeName"],e=!1,e=null!=c.lastChild&&"img"==c.lastChild.nodeName.toLowerCase(),q==d?(changeElementStyle(a,b),e?null:a.childNodes[0]):"h1"==d||"h2"==d?(f=document.createElement(d),f.innerHTML=a.innerHTML,changeElementStyle(f,b),$(a).replaceWith($(f)),e?(updateCollapsedRange(f,1),bindImgClickEventHandler(),null):f.childNodes[0]):e?(k=c.lastChild,k.style.marginLeft="0px",k.style.display="inherit",l=k.className,m=document.createElement("p"),m.innerHTML=k.outerHTML,n=null,o=1,"blockquote"==d?(m=m.firstChild,m.style.display="block",m.style.marginLeft="-1.35em",g=document.createElement(d),g.className=b["className"],g.appendChild(m),$(a).replaceWith($(g)),n=g):"p"==d?($(a).replaceWith($(m)),n=m):("ul"==d||"ol"==d)&&(m=m.firstChild,m.style.display="block",m.style.marginLeft="imgCommonStyle"==l?"-1.5em":"-2.5em",i=document.createElement("li"),i.innerHTML="<br>",i.appendChild(m),p=document.createElement(d),p.appendChild(i),$(a).replaceWith($(p)),n=p),updateCollapsedRange(n,o),bindImgClickEventHandler(),null):"blockquote"==d?(g=document.createElement(d),g.className=b["className"],h=document.createElement("p"),h.innerHTML=a.innerHTML,changeElementStyle(h,b),g.appendChild(h),$(a).replaceWith($(g)),h.childNodes[0]):"p"==d?(h=document.createElement(d),h.innerHTML=a.innerHTML,changeElementStyle(h,b),$(a).replaceWith($(h)),h.childNodes[0]):"ol"==d||"ul"==d?(i=document.createElement("li"),i.innerHTML=a.innerHTML,$(i).wrap("<"+d+"></"+d+">"),j=i.parentNode,changeElementStyle(j,b),$(a).replaceWith($(j)),i.childNodes[0]):null)}function changeLiNodeStyle(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x=a.nodeName.toLowerCase();if("li"!=x)return null;if(d=a.parentNode,e=d.nodeName.toLowerCase(),"ol"!=e&&"ul"!=e)return null;if(f=c.startContainer,g=!1,h=-1,"#text"==f.nodeName.toLowerCase()){for(g=!0,i=0;i<a.childNodes.length;i++)if(a.childNodes[i]===f){h=i;break}}else h=c.startOffset-1;return j=b["nodeName"],e==j?(changeElementStyle(d,b),g?a.childNodes[h]:null):"ul"==j||"ol"==j?(k=document.createElement(j),k.innerHTML=d.innerHTML,changeElementStyle(k,b),l=$(a).index(),$(d).replaceWith($(k)),$(k).find("img").length>0&&bindImgClickEventHandler(),m=k.childNodes[l],g?n=m.childNodes[h]:(0>h&&(h=0),updateCollapsedRange(m,h),null)):(o=wrapLiNodeToPNode(a,h),p=1==o.childNodes.length&&"img"==o.childNodes[0].nodeName.toLowerCase(),p?(t=o.childNodes[0],t.style.marginLeft="0px",t.style.display="inherit",t.className,u=document.createElement("p"),u.innerHTML=t.outerHTML,c=null,v=1,"blockquote"==j?(u=u.firstChild,u.style.display="block",u.style.marginLeft="-1.35em",q=document.createElement(j),q.className=b["className"],q.appendChild(u),$(o).replaceWith($(q)),c=q):"p"==j?($(o).replaceWith($(u)),c=u):("h1"==j||"h2"==j)&&(u=u.firstChild,u.style.display="block",w=document.createElement(j),w.appendChild(u),$(o).replaceWith($(w)),c=w),updateCollapsedRange(c,v),bindImgClickEventHandler(),null):"blockquote"==j?(q=document.createElement(j),q.className=b["className"],r=document.createElement("p"),r.innerHTML=o.innerHTML,changeElementStyle(r,b),q.appendChild(r),$(o).replaceWith($(q)),r.childNodes[0]):"p"==j||"h1"==j||"h2"==j?(s=document.createElement(j),s.innerHTML=o.innerHTML,changeElementStyle(s,b),$(o).replaceWith($(s)),s.childNodes[0]):null)}function changeBlockquoteImgStyle(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r=a.nodeName.toLowerCase();return"img"!=r?null:(c=a.parentNode,r=c.nodeName.toLowerCase(),"blockquote"!=r?null:(d=b["nodeName"],r==d?(c.className=b["className"],changeElementStyle($(c).find("p"),b),null):(e=null,f=$(c).find("p"),f.length>0&&(e=getElementStyle(f[0])),g=$(a).prevAll(),h=$(a).nextAll(),i=[],j=[],k=0,g.length>0&&(i.push("<blockquote class='"+c.className+"'>"),$(g).each(function(){var a=$(this)[0];"img"==a.nodeName.toLowerCase()?1==i.count?i.push(a.outerHTML):i.splice(1,0,a.outerHTML):1==i.count?i.push("<p>"+a.innerHTML+"</p>"):i.splice(1,0,"<p>"+a.innerHTML+"</p>")}),i.push("</blockquote>"),j.push($(i.join(""))),i=[],k+=1,e&&changeElementStyle($(j[k-1]).find("p"),e)),a.style.marginLeft="0px",a.style.display="inherit",l=a.className,m=document.createElement("p"),m.innerHTML=a.outerHTML,n=null,o=1,"p"==d?(j.push($(m)),k+=1,n=m):"ol"==d||"ul"==d?(m=m.firstChild,m.style.display="block",m.style.marginLeft="imgCommonStyle"==l?"-1.5em":"-2.5em",p=document.createElement("li"),p.innerHTML="<br>",p.appendChild(m),i.push("<"+d+">"),i.push(p.outerHTML),i.push("</"+d+">"),j.push($(i.join(""))),k+=1,i=[],n=$(j[k-1])[0]):("h1"==d||"h2"==d)&&(m=m.firstChild,m.style.display="block",q=document.createElement(d),q.appendChild(m),j.push($(q)),k+=1,n=q),h.length>0&&(i.push("<blockquote class='"+c.className+"'>"),$(h).each(function(){var a=$(this)[0];"img"==a.nodeName.toLowerCase()?i.push(a.outerHTML):i.push("<p>"+a.innerHTML+"</p>")}),i.push("</blockquote>"),j.push($(i.join(""))),i=[],k+=1,e&&changeElementStyle($(j[k-1]).find("p"),e)),$(c).replaceWith(j),updateCollapsedRange(n,o),bindImgClickEventHandler(),null)))}function unwrapPNodeBlockquote(a){var b,c,d,e,f,g,h,i,j,k=a.nodeName.toLowerCase();return"p"==k&&(b=a.parentNode,k=b.nodeName.toLowerCase(),"blockquote"==k)?(c=getElementStyle(a),d=$(a).prevAll(),e=$(a).nextAll(),f=[],g=[],h=0,i=!1,d.length>0&&(f.push("<blockquote class='"+b.className+"'>"),$(d).each(function(){var a=$(this)[0];"img"==a.nodeName.toLowerCase()?(1==f.count?f.push(a.outerHTML):f.splice(1,0,a.outerHTML),i=!0):1==f.count?f.push("<p>"+a.innerHTML+"</p>"):f.splice(1,0,"<p>"+a.innerHTML+"</p>")}),f.push("</blockquote>"),g.push($(f.join(""))),f=[],h+=1,changeElementStyle($(g[h-1]).find("p"),c)),j=document.createElement("p"),j.innerHTML=a.innerHTML,changeElementStyle(j,c),g.push($(j)),h+=1,e.length>0&&(f.push("<blockquote class='"+b.className+"'>"),$(e).each(function(){var a=$(this)[0];"img"==a.nodeName.toLowerCase()?(f.push(a.outerHTML),i=!0):f.push("<p>"+a.innerHTML+"</p>")}),f.push("</blockquote>"),g.push($(f.join(""))),f=[],h+=1,changeElementStyle($(g[h-1]).find("p"),c)),$(b).replaceWith(g),i&&bindImgClickEventHandler(),j):void 0}function wrapLiNodeToPNode(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r=a.nodeName.toLowerCase();if("li"==r&&(c=a.parentNode,r=c.nodeName.toLowerCase(),"ul"==r||"ol"==r)){for(d=getElementStyle(c),e=$(a).prevAll(),f=$(a).nextAll(),g=[],h=[],i=0,j=!1,e.length>0&&(g.push("<"+r+">"),$(e).each(function(){$(this).find("img").length>0&&(j=!0),1==g.count?g.push("<li>"+$(this).html()+"</li>"):g.splice(1,0,"<li>"+$(this).html()+"</li>")}),g.push("</"+r+">"),h.push($(g.join(""))),g=[],i+=1,changeElementStyle(h[i-1],d)),k=null,l=null,m=a.childNodes,n=0;n<m.length;n++)o=m[n],p=o.nodeName.toLowerCase(),q=null,"#text"==p?(q=document.createElement("p"),q.innerHTML=o.nodeValue,changeElementStyle(q,d)):"img"==p&&(o.style.marginLeft="0px",o.style.display="inherit",q=document.createElement("p"),q.innerHTML=o.outerHTML,j=!0),q&&(h.push($(q)),i+=1,n==b&&(k=q),l||(l=q));return k||("<br>"==a.innerHTML?(k=document.createElement("p"),k.innerHTML="<br>",h.push($(k)),i+=1):k=l),"img"==k.childNodes[0].nodeName.toLowerCase()&&(j=!1),f.length>0&&(g.push("<"+r+">"),$(f).each(function(){$(this).find("img").length>0&&(j=!0),g.push("<li>"+$(this).html()+"</li>")}),g.push("</"+r+">"),h.push($(g.join(""))),g=[],i+=1,changeElementStyle(h[i-1],d)),$(c).replaceWith(h),j&&bindImgClickEventHandler(),k}}function keyDown(){var a,b,c,d,e,f,g,h,i;return cardType&&13==window.event.keyCode&&(a=getPageEleHeight(),a>=pageHeight)?!1:(console.log("----- js keyCode -----:  "+window.event.keyCode),8!=window.event.keyCode?!0:(getRange(),(b=rg.collapsed)?(c=rg.startContainer,d=c.nodeName.toUpperCase(),c!=rg.endContainer?!0:"LI"!=d&&"BLOCKQUOTE"!=d||null==c.lastChild||(e=c.lastChild,"IMG"!=e.nodeName.toUpperCase())?"P"!=d?"<br>"==c.innerHTML&&"H1"==c.nodeName.toUpperCase()&&(g=document.getElementById("page"),g.childNodes[0]==c)?(g.removeChild(c),!0):!0:"<br>"==c.innerHTML&&"BLOCKQUOTE"==c.parentNode.nodeName.toUpperCase()&&1==c.parentNode.childNodes.length&&c===c.parentNode.childNodes[0]&&(g=document.getElementById("page"),g.childNodes[0]==c.parentNode)?(g.removeChild(c.parentNode),!0):(h=c.childNodes.length,1!=h?!0:(i=c.childNodes[0],d=i.nodeName.toUpperCase(),"IMG"!=d?!0:0==rg.startOffset?!0:(f=getImageSrc(i),sendDelImgMsgToView(f),!0))):(f=getImageSrc(e),e.parentNode.removeChild(e),sendDelImgMsgToView(f),!1)):!0))}function getImageSrc(a){var b,c,d=a.src,e="";try{e=a.getAttributeNode("originalsrc").value}catch(f){e=""}return b=d.lastIndexOf("/")+1,c=d.substring(b,d.length),e.length>0&&(b=e.lastIndexOf("/")+1,c=c+"|"+e.substring(b,e.length)),c}function sendDelImgMsgToView(){contentChange=!0}function keyUp(){var a,b=document.getElementById("page"),c=b.childNodes.length;return 0==c?(a=document.createElement("p"),a.innerHTML="<br>",b.appendChild(a),updateCollapsedRange(a,0),!0):handleKeyUp()}function handleKeyUp(){var a,b,c,d,e,f,g,h,i,j,k;if(getRange(),a=rg.startContainer,b=a.nodeName.toUpperCase(),c=null,d=!1,e=!1,"#TEXT"==b&&null!=a.nextSibling&&"IMG"==a.nextSibling.nodeName.toUpperCase()&&"LI"!=a.parentNode.nodeName.toUpperCase()&&(d=!0,e=!0),"#TEXT"==b&&null!=a.previousSibling&&"IMG"==a.previousSibling.nodeName.toUpperCase()&&"LI"!=a.parentNode.nodeName.toUpperCase()&&(d=!0),d)return f=a.nodeValue,c=a.parentNode,c.removeChild(a),g=document.createElement("p"),g.innerHTML=f,e?$(g).insertBefore($(c)):$(g).insertAfter($(c)),h=f.length,updateCollapsedRange(g.childNodes[0],h),!0;if("SPAN"==b&&"<br>"==a.innerHTML&&"FONT"==a.parentNode.nodeName.toUpperCase())return i=a.parentNode,"DIV"==i.parentNode.nodeName.toUpperCase()&&(i=i.parentNode),j=document.createElement("p"),j.innerHTML="<br>",$(i).replaceWith($(j)),updateCollapsedRange(j,0),!0;if("SPAN"==b&&"<br>"==a.innerHTML&&"DIV"==a.parentNode.nodeName.toUpperCase()&&(k=document.getElementById("page"),1==k.childNodes.length&&a===k.childNodes[0]))return j=document.createElement("p"),j.innerHTML="<br>",$(a).replaceWith($(j)),updateCollapsedRange(j,0),!0;if("DIV"==b&&"<br>"==a.innerHTML&&document.getElementById("page")==a.parentNode)return j=document.createElement("p"),j.innerHTML="<br>",$(a).replaceWith($(j)),updateCollapsedRange(j,0),!0;if("BLOCKQUOTE"==b&&"<br>"==a.innerHTML)return a.innerHTML="",j=document.createElement("p"),j.innerHTML="<br>",a.appendChild(j),updateCollapsedRange(j,0),!0;if("#TEXT"==b&&(c=a.parentNode,b=c.nodeName.toUpperCase(),"P"!=b&&"LI"!=b&&"H1"!=b&&"H2"!=b)){if("SPAN"!=b&&"DIV"!=b)return!0;c=c.parentNode,b=c.nodeName.toUpperCase()}return"P"==a.nodeName.toUpperCase()&&"IMG"==a.firstChild.nodeName.toUpperCase()&&(c=a),null==c?!0:($(c).find("span").each(function(){$(this).contents().unwrap()}),!0)}function getElementPosY(a){if(!a||1!=a.nodeType)return 0;var b=0;do b+=a.offsetTop,a=a.offsetParent;while(a);return b}function getTextOffsetHeight(a){var b,c,d,e,f=a,g=0;return g+=getElementPosY(f.parentNode),b="",c=rg.startOffset,0==c?b="Empty":(b=f.nodeValue.substring(0,c),"<br>"==b&&(b="br")),d=document.createElement("p"),d.style.fontFamily=curFontFamily,d.style.fontSize=curFontSize,d.style.visibility="hidden",d.innerHTML=b,e=document.getElementById("page"),e.appendChild(d),g+=d.offsetHeight,d.style.visibility="visible",e.removeChild(d),g}function getPosY(){var a,b,c;return getRange(),a=rg.startContainer,b=a.nodeName.toUpperCase(),c=0,"#TEXT"==b&&(c+=getTextOffsetHeight(a)),("P"==b||"H1"==b||"H2"==b)&&(c+=getElementPosY(a),c+=a.offsetHeight),"LI"==b&&(null!=a.lastChild&&"IMG"==a.lastChild.nodeName.toUpperCase()?(c+=getElementPosY(a.lastChild),c+=a.lastChild.offsetHeight):(c+=getElementPosY(a),c+=a.offsetHeight)),"BLOCKQUOTE"==b&&null!=a.lastChild&&"IMG"==a.lastChild.nodeName.toUpperCase()&&(c+=getElementPosY(a.lastChild),c+=a.lastChild.offsetHeight),window.jsObj.getVerticalY(c),c}function getContentSize(){return $("div").outerHeight(!0)}function getFocus(){document.getElementById("page").focus()}function handlepaste(a){var b=window.jsObj.getClipboardData();b=b.replace("{\\rtf1\\ansi\\ansicpg1252\n{\\fonttbl}\n{\\colortbl;\\red255\\green255\\blue255;}\n}",""),cardType&&b.length>=140&&(b=b.substring(0,140)),getRange(),addContent(b),a.preventDefault()}function handleInput(){contentChange=!0}function getCoverImgName(){var a=document.getElementById("page"),b=a.getElementsByTagName("img");window.jsObj.getCoverImgName(b.length>0?b[0].src:"")}function abstractTextFromElement(a,b){var c,d="",e=a.childNodes,f=e.length,g="";for(c=0;f>c&&!("<br>"!=e[c].innerHTML&&(g=3==e[c].nodeType?e[c].nodeValue:abstractTextFromElement(e[c],0),0!=g.length&&"\n"!=g&&"\r\n"!=g&&(d+=g,c!=f-1&&d.length>0&&d.lastIndexOf("\n")!=d.length-1&&(d+="\n"),b&&d.length>=b)));++c);return d}function abstractTextFromBody(){var a=document.getElementById("page"),b=abstractTextFromElement(a,200);window.jsObj.getTextContent(b)}function abstractRichTextFromElement(a){var b,c="",d=a.childNodes,e=d.length,f="";for(b=0;e>b;++b)"<br>"!=d[b].innerHTML&&(f=3==d[b].nodeType?d[b].nodeValue:"img"==d[b].nodeName.toLowerCase()?d[b].outerHTML:abstractRichTextFromElement(d[b]),0!=f.length&&"\n"!=f&&"\r\n"!=f&&(c+=f,b!=e-1&&c.length>0&&c.lastIndexOf("\n")!=c.length-1&&(c+="\n")));return c}function abstractRichTextFromBody(){var a=document.getElementById("page"),b=abstractRichTextFromElement(a);return b}function contentIsEmpty(){var a,b=document.getElementById("page").childNodes;return b.length>1?!1:(a=b[0].nodeName.toLowerCase(),"p"==a&&"<br>"==b[0].innerHTML?!0:!1)}function bindImgClickEventHandler(){$("img").unbind("click"),$("img").bind("click",function(){imgClicked($(this)[0])})}function imgClicked(a){var b,c,d,e,f=document.getElementById("page").contentEditable;if("true"==f){if(b=a.parentNode,c=b.nodeName.toLowerCase(),"p"==c||"h1"==c||"h2"==c)updateCollapsedRange(b,1);else if("li"==c||"blockquote"==c){for(d=-1,e=0;e<b.childNodes.length;e++)if(b.childNodes[e]===a){d=e;break}d>=0&&updateCollapsedRange(b,d+1)}}else getImageSrc(a)}function changeBodyBgColor(a){var b=document.body;b.style.backgroundImage="none",b.style.backgroundColor=a}function getPageEleHeight(){var a=document.getElementById("page").lastChild;return getElementPosY(a)}function changeArticleBodyBgImage(a,b){var c=new Image;c.src=a,c.onload=function(){var a=c.width/b;document.body.style.backgroundSize=a+"px auto"},document.body.style.backgroundImage="url('"+a+"')"}function updateCardBodyStyle(a,b,c){"top"==c?document.body.style.backgroundPosition="0px 0px":"center"==c&&(document.body.style.backgroundPosition="center center");var d=$("#site").width();document.body.style.backgroundSize=d+"px "+b+"px",document.body.style.backgroundRepeat="no-repeat",document.body.style.backgroundImage="url('"+a+"')"}function updateCardPageStyle(a,b,c){var d,e,f,g;cardType=!0,bodyHeight=a,pageHeight=b-pagePaddingTopAndBottomH,d=$("#site").width(),document.body.style.width=d+"px",document.body.style.height=bodyHeight+"px",e=document.getElementById("page"),e.style.height=pageHeight+"px","top"==c?(f=d-32,e.style.width=f+"px",e.style.margin="auto",setCardBackgroundBorder(0)):"center"==c&&(g=(a-b)/2,e.style.paddingTop=g+24+"px",f=d-32,e.style.width=f+"px",e.style.margin="auto",setCardBackgroundBorder(g))}function changeCardBgImageAndText(a,b,c,d,e){document.body.style.backgroundColor="rgb(49, 49, 49)";var f=-1==a.indexOf("zine_card");f?($(".card-background").remove(),updateCardBodyStyle(a,c,d),updateCardPageStyle(b,c,d)):(updateCardPageStyle(b,c,d),setCardBackground(a,e),"top"==d&&setCardBackgroundBorder(4))}function setCardBackground(a,b){$(".card-background").css("background-image","url("+a+")"),$(".card-background p").text(b)}function setCardBackgroundBorder(a){$(".card-background").css({"border-top-width":a,"border-bottom-width":a})}function initContentWithFile(a){var b=document.getElementById("page");null==b&&(b=document.createElement("div"),b.id="page",document.getElementById("site").appendChild(b),b.innerHTML="<p><br></p>"),$.ajax({url:"file://"+a,cache:!1}).done(function(a){var b,c,d,e,f,g=a;if(g&&0!=g.length||(g="<p><br></p>"),document.getElementById("page").innerHTML=g,imgSize(),b=null,c=$("#page span.title"),1==c.length&&(d=c.find(".title-img-outer"),1==d.length&&(hasPosterEle=!0,b=c[0])),e=document.getElementById("page").contentEditable,"true"!=e){if(bindImgClickEventHandler(),hasPosterEle&&$("#page").css("padding-top",0),f=getWordsCount(),0>=f)return}else hasPosterEle&&(posterEleOuterHTML=new String(b.outerHTML),b.parentNode.removeChild(b))}).fail(function(){document.getElementById("page").innerHTML="<p><br></p>"})}function bindEvent4Edit(){var a=document.getElementById("page");null==a&&(a=document.createElement("div"),a.id="page",document.getElementById("site").appendChild(a),a.innerHTML="<p><br></p>"),a.contentEditable=!0,a.setAttribute("onkeydown","return keyDown(event)"),a.setAttribute("onkeyup","return keyUp(event)"),a.setAttribute("onfocus","handleOnfocus()"),a.setAttribute("onblur","handleOnblur()"),a.setAttribute("onpaste","handlepaste(event)"),a.setAttribute("oninput","handleInput()"),a.setAttribute("autocorrect","off"),a.setAttribute("autocapitalization","off")}function initContentWithString(a,b){var c,d,e,f,g,h=document.getElementById("page");if(null==h&&(h=document.createElement("div"),h.id="page",document.getElementById("site").appendChild(h),h.innerHTML="<p><br></p>"),document.getElementById("page").innerHTML=a,document.getElementById("page").contentEditable=b,"true"!=b&&imgLaterLoad("file:///android_asset/androidDefaultImg.jpg"),imgSize(),c=null,d=$("#page span.title"),1==d.length&&(e=d.find(".title-img-outer"),1==e.length&&(hasPosterEle=!0,c=d[0])),"true"!=b){if(bindImgClickEventHandler(),hasPosterEle&&($("#page").css("padding-top",0),f=$("#site").width(),$(".title-img ,.mask-gradiant ,.mask-solid").width(f),$(".title-img").height(f),$(".mask-gradiant ,.mask-solid").height(f+1)),g=getWordsCount(),0>=g)return}else hasPosterEle&&(posterEleOuterHTML=new String(c.outerHTML),c.parentNode.removeChild(c))}function getWordsCount(){var a,b,c=document.getElementById("page"),d=abstractTextFromElement(c,0);return d.length<=0?0:(a=new RegExp("[一-龥]|[お-ゟ]|[゠-ヿ]|[ㇰ-ㇿ]|[ༀ-࿿]|([a-zA-Z]+)","g"),b=d.match(a),b?b.length:0)}function addFooterImg(a){var b=document.createElement("img");b.src=a,b.style.width="100%",document.getElementById("site").appendChild(b)}function getAllImagesName(){var a,b=$("img"),c=[];b.length>0&&$(b).each(function(){var a=$(this)[0].src;c.push(a)}),a="",c.length>0&&(a=c.join(";"),c=null),window.jsObj.getAllImageName(a)}function getOriginalContent(){window.jsObj.getOriginalContent(document.getElementById("page").innerHTML)}function saveArticle(a){window.handler.saveArticle(document.getElementById("page").innerHTML,a)}function getPosterInfo(){var a,b,c,d,e,f,g,h,i,j,k="",l="",m="",n=$("#page span.title");if(n.length<=0)return window.jsObj.getPosterImg(""),void 0;if(a=n.find(".title-text"),1==a.length&&(b=a[0],b.childNodes.length>0&&(c=b.childNodes[0],3==c.nodeType&&(k=c.nodeValue))),d=n.find(".title-img-outer"),1!=d.length)return window.jsObj.getPosterImg(""),void 0;for(e=d[0],f=e.childNodes,g=f.length,h=0;g>h&&(i=f[h],"div"!=i.nodeName.toLowerCase()||(j=i.className,"title-img"==j?(l=i.style.backgroundImage,l=l.replace("url(",""),l=l.replace(")",""),window.jsObj.getPosterImg(l)):("mask-origin"==j||"mask-gradiant"==j||"mask-solid"==j)&&(m=j),""==m||""==l));h++);}function originalPosterEleOuterHTML(){window.jsObj.getJSPosterInfo(hasPosterEle?posterEleOuterHTML.toString():"")}function changePosterBgURL(a){var b,c;hasPosterEle&&(b=$(".title-img").css("background-image"),b=b.replace("url(",""),b=b.replace(")",""),b=b.substring(b.lastIndexOf("/")+1,b.length),b="url('"+a+b+"')",$(".title-img").css({"background-image":b}),c=$("#site").width(),$(".title-img ,.mask-gradiant ,.mask-solid").width(c),$(".title-img").height(c),$(".mask-gradiant ,.mask-solid").height(c+1))}function changePosterTitleStyle(a,b){hasPosterEle&&$(".title-text").css({width:a,"margin-top":b})}function loadFonts(a){var b,c,d,e,f=document.getElementById("site"),g=document.createElement("div");for(f.appendChild(g),b=a.split(","),c=b.length,d=0;c>d;++d)e=document.createElement("p"),g.style.marginTop="-999px",e.innerHTML="font Family",e.style.fontFamily=b[d],g.appendChild(e);setTimeout(function(){f.removeChild(g)},10)}function fontFamilyStyleAdd(a,b){var c,d=document.getElementsByTagName("head")[0];document.getElementById("font_family")?c=document.getElementById("font_family"):(c=document.createElement("style"),c.id="font_family",c.type="text/css",d.appendChild(c)),c.innerHTML=c.innerHTML+"@font-face {font-family: "+a+";src: url("+b+")}"}var request,debugMode,rg,cursorCurPosY,contentChange,id_of_getcurposy_interval,id_of_checkchange_interval,handleSpecialContentFlag,curNodeName,curClassName,curFontFamily,curFontSize,curFontColor,curFontStyle,curFontWeight,curTextDecoration,curTextAlign,usrFontFamily,usrFontColor,cardType,bodyHeight,pagePaddingTopAndBottomH,pageHeight,curPositionY,posterEleOuterHTML,hasPosterEle;document.addEventListener("touchend",function(a){var b=a.changedTouches.item(0),c=b.clientX,d=b.clientY,e=document.getElementById("page").getClientRects()[0];c>e.left&&d<e.bottom||document.getElementById("page").focus()},!1),request=createXmlRequest(),debugMode=!1,debugTrace(debugMode),console.log=function(a){window.jsObj.log(a)},rg=null,cursorCurPosY=0,contentChange=!1,handleSpecialContentFlag=!1,curNodeName="p",curClassName="",curFontFamily="Heiti SC",curFontSize="1em",curFontColor="rgba(32,32,32,1.0)",curFontStyle="normal",curFontWeight="normal",curTextDecoration="none",curTextAlign="left",usrFontFamily="Heiti SC",usrFontColor="rgba(32,32,32,1.0)",cardType=!1,bodyHeight=480,pagePaddingTopAndBottomH=56,pageHeight=480-pagePaddingTopAndBottomH,window.onload=function(){console.log("window on load");try{$(document).ready(function(){console.log("jquery ready")})}catch(a){console.log("jquery error: "+a)
}},window.onunload=function(){request=null,console=null,posterEleOuterHTML=null},curPositionY=0,posterEleOuterHTML=null,hasPosterEle=!1;